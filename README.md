# EventBooker - Система бронирования мероприятий

EventBooker — это сервис бронирования мест на мероприятия с автоматической отменой неоплаченных бронирований по истечении заданного времени.

## Описание

Когда люди записываются на мероприятия (концерты, мастер-классы, курсы, лекции) — часто возникает ситуация: кто-то бронирует место, но не оплачивает вовремя. Организатору важно не держать такие «мертвые души», а освободить место для других. Поэтому в реальных системах бронирования всегда есть правило: если не оплатил (подтвердил) в течение определенного времени — бронь аннулируется.

## Основные возможности

- Создание мероприятий с указанием даты, количества мест и дедлайна
- Бронирование мест на мероприятия
- Подтверждение бронирований
- Автоматическая отмена неоплаченных бронирований
- Веб-интерфейс для пользователей и администраторов
- REST API для интеграции

## Технологии

- **Go** - основной язык программирования
- **PostgreSQL** - реляционная база данных
- **Docker** - контейнеризация приложения
- **Chi Router** - HTTP маршрутизатор
- **Slog** - логирование
- **HTML/CSS/JavaScript** - фронтенд

## Структура проекта

```
eventBooker/
├── cmd/
│   └── event-booker/           # Точка входа в приложение
│       └── main.go
├── internal/
│   ├── config/                 # Конфигурация приложения
│   ├── http-server/            # HTTP сервер и хендлеры
│   │   ├── handlers/           # Обработчики запросов
│   │   │   └── event/
│   │   │       ├── createEvent/
│   │   │       ├── createBooking/
│   │   │       ├── confirmBooking/
│   │   │       ├── getEventInfo/
│   │   │       └── getAllEvents/
│   │   └── middleware/         # Промежуточное ПО
│   ├── lib/                    # Вспомогательные библиотеки
│   ├── models/                 # Модели данных
│   └── storage/                # Работа с базой данных
├── migrations/                 # Миграции базы данных
├── static/                     # Статические файлы (HTML, CSS, JS)
├── config/                     # Конфигурационные файлы
├── Dockerfile                  # Docker образ приложения
└── docker-compose.yml          # Docker Compose конфигурация
```

## Быстрый старт

### Требования

- Docker и Docker Compose
- Git

### Установка и запуск

1. **Клонирование репозитория:**
```bash
git clone github.com/veylin2175/eventBooker
cd eventBooker
```

2. **Запуск приложения:**
```bash
docker-compose up -d
```

3. **Открытие приложения:**
Откройте в браузере: http://localhost:8080

### Остановка приложения

```bash
docker-compose down
```

## API Endpoints

### Создание мероприятия
```
POST /events
Content-Type: application/json

{
    "title": "Название мероприятия",
    "date": "2025-12-31T20:00:00Z",
    "total_seats": 100,
    "deadline": 30
}
```

### Получение списка мероприятий
```
GET /events
```

### Получение информации о мероприятии
```
GET /events/{id}
```

### Бронирование места
```
POST /events/{id}/book
Content-Type: application/json

{
    "user_id": "user123"
}
```

### Подтверждение бронирования
```
POST /events/{id}/confirm
Content-Type: application/json

{
    "user_id": "user123"
}
```

## Веб-интерфейс

### Пользовательская часть
- Просмотр доступных мероприятий
- Бронирование мест
- Подтверждение бронирований

### Административная часть
- Создание новых мероприятий
- Просмотр всех мероприятий и статистики

## Конфигурация

### Переменные окружения
Создайте файл `config/local.yml` и перенесите туда данные из `config/example.local.yml`, заменив пароль от БД на свой.

## Автоматическая отмена бронирований

Сервис автоматически отменяет неоплаченные бронирования каждую минуту. Если бронирование не подтверждено в течение времени, указанного в `deadline_minutes` для мероприятия, оно автоматически удаляется.

## Тестирование

### Ручное тестирование

1. Откройте http://localhost:8080
2. Перейдите в админ-панель и создайте мероприятие
3. Вернитесь в пользовательскую часть и забронируйте место
4. Подтвердите бронирование
5. Проверьте, что места уменьшились

### Тестирование API через curl

```bash
# Создание мероприятия
curl -X POST http://localhost:8080/events \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Тестовое мероприятие",
    "date": "2025-12-31T20:00:00Z",
    "total_seats": 50,
    "deadline": 10
  }'

# Получение списка мероприятий
curl http://localhost:8080/events

# Бронирование места
curl -X POST http://localhost:8080/events/1/book \
  -H "Content-Type: application/json" \
  -d '{"user_id": "user123"}'

# Подтверждение бронирования
curl -X POST http://localhost:8080/events/1/confirm \
  -H "Content-Type: application/json" \
  -d '{"user_id": "user123"}'
```

## Docker

### Сборка образа
```bash
docker build -t event-booker .
```

### Запуск контейнера
```bash
docker run -p 8080:8080 event-booker
```

## Безопасность

- Использование транзакций для обеспечения целостности данных
- Проверка доступности мест перед бронированием
- Предотвращение дублирования бронирований
- Валидация входных данных

## Мониторинг и логирование

- Подробное логирование всех операций
- Отслеживание ошибок и исключений
- Мониторинг производительности
